<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Version Inventory — Excel + Zabbix</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <header>
            <h1>Version Inventory — Excel + Zabbix (Frontend Only)</h1>
            <nav>
                <button class="tab-btn" data-tab="dashboard">Dashboard</button>
                <button class="tab-btn" data-tab="env">Environment</button>
                <button class="tab-btn" data-tab="host">Host</button>
                <button class="tab-btn" data-tab="service">Service</button>
                <button class="tab-btn" data-tab="endpoint">Endpoint</button>
                <button class="tab-btn" data-tab="snapshot">VersionSnapshot</button>
                <button class="tab-btn" data-tab="matrix">Version Matrix</button>
                <button class="tab-btn" data-tab="excel">Excel Workspace</button>
                <button class="tab-btn" data-tab="sql">SQL / BI Engine</button>
                <button class="tab-btn" data-tab="templates">Templates</button>
                <button class="tab-btn" data-tab="datasets">Datasets</button>
                <button class="tab-btn" data-tab="scan">Scan / Jobs</button>
                <button class="tab-btn" data-tab="importExport">Import / Export</button>
            </nav>
        </header>

        <!-- ===== DASHBOARD ===== -->
        <section class="tab" id="dashboard">
            <h2>Dashboard & Analytics</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Dashboard</strong> — это аналитическая панель, которая показывает общую картину по
                        версиям сервисов, окружениям и хостам. Здесь вы можете увидеть распределение версий, найти
                        отстающие окружения и проследить историю изменений.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Просмотрите Overview — общую статистику по количеству окружений, хостов, сервисов и
                                эндпоинтов</li>
                            <li>Изучите графики распределения версий по окружениям и сервисам</li>
                            <li>Проверьте раздел Anomalies & Alerts — здесь показаны отстающие версии и проблемы</li>
                            <li>Просмотрите Version History — историю изменений версий во времени</li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Источники данных:</strong> VersionSnapshot, Endpoint, Service, Environment
                    </div>
                </div>
            </div>

            <div class="dashboard-filters">
                <h3>Фильтры</h3>
                <div class="toolbar">
                    <label>Окружение:
                        <select id="dashboardFilterEnvironment">
                            <option value="">Все окружения</option>
                        </select>
                    </label>
                    <label>Сервис:
                        <select id="dashboardFilterService">
                            <option value="">Все сервисы</option>
                        </select>
                    </label>
                    <button id="dashboardResetFilters" class="btn-small">Сбросить фильтры</button>
                </div>
            </div>

            <div class="dashboard-overview">
                <h3>Overview</h3>
                <div class="dashboard-cards" id="dashboardCards">
                    <!-- Cards будут добавлены динамически -->
                </div>
                <p class="dashboard-source-label">
                    <strong>Источник данных:</strong> Environment, Host, Service, Endpoint, VersionSnapshot
                </p>
            </div>

            <div class="dashboard-section">
                <h3>Version Distribution by Environment</h3>
                <canvas id="versionByEnvChart" width="800" height="400"></canvas>
                <p class="dashboard-source-label">
                    <strong>Источник данных:</strong> VersionSnapshot → Endpoint → Environment
                </p>
            </div>

            <div class="dashboard-section">
                <h3>Version Distribution by Service</h3>
                <canvas id="versionByServiceChart" width="800" height="400"></canvas>
                <p class="dashboard-source-label">
                    <strong>Источник данных:</strong> VersionSnapshot → Endpoint → Service
                </p>
            </div>

            <div class="dashboard-section">
                <h3>Anomalies & Alerts</h3>
                <div id="dashboardAnomalies">
                    <!-- Аномалии будут добавлены динамически -->
                </div>
                <p class="dashboard-source-label">
                    <strong>Источник данных:</strong> VersionSnapshot, Endpoint, Service, Environment (анализ
                    несоответствий и отстающих версий)
                </p>
            </div>

            <div class="dashboard-section">
                <h3>Version History</h3>
                <div id="dashboardHistory">
                    <!-- История будет добавлена динамически -->
                </div>
                <p class="dashboard-source-label">
                    <strong>Источник данных:</strong> VersionSnapshot → Endpoint → Service, Environment (сортировка по
                    timestamp)
                </p>
            </div>
        </section>

        <!-- ===== ENVIRONMENT ===== -->
        <section class="tab" id="env">
            <h2>Environment</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Environment</strong> — это окружения, в которых работают ваши сервисы (например:
                        Production, Testing, Development). Окружения используются для группировки хостов и эндпоинтов.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Добавить окружение" для создания нового окружения</li>
                            <li>Заполните поля: id (уникальный идентификатор), name (название), description (описание)
                            </li>
                            <li>Редактируйте данные прямо в таблице — просто кликните на ячейку</li>
                            <li>Удалите строку кнопкой ✕ справа</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="toolbar">
                <button class="add-row" data-entity="environments">Добавить окружение</button>
            </div>
            <table class="entity-table" data-entity="environments"></table>
        </section>

        <!-- ===== HOST ===== -->
        <section class="tab" id="host">
            <h2>Host</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Host</strong> — это физические или виртуальные хосты (серверы), на которых работают ваши
                        сервисы. Каждый хост привязан к окружению.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Добавить хост" для создания нового хоста</li>
                            <li>Заполните поля: id (уникальный идентификатор), name (имя хоста), ip (IP-адрес), envId
                                (ID окружения)</li>
                            <li>Редактируйте данные прямо в таблице — просто кликните на ячейку</li>
                            <li>Удалите строку кнопкой ✕ справа</li>
                            <li>Импортируйте хосты из Excel через вкладку Excel Workspace</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="toolbar">
                <button class="add-row" data-entity="hosts">Добавить хост</button>
            </div>
            <table class="entity-table" data-entity="hosts"></table>
        </section>

        <!-- ===== SERVICE ===== -->
        <section class="tab" id="service">
            <h2>Service</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Service</strong> — это логические сервисы (приложения, брокеры, монолиты), версии
                        которых вы отслеживаете. Сервисы не привязаны к конкретным хостам, но связаны с эндпоинтами.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Добавить сервис" для создания нового сервиса</li>
                            <li>Заполните поля: id (уникальный идентификатор), name (название сервиса), owner
                                (владелец/команда)</li>
                            <li>Редактируйте данные прямо в таблице — просто кликните на ячейку</li>
                            <li>Удалите строку кнопкой ✕ справа</li>
                            <li>Импортируйте сервисы из Excel через вкладку Excel Workspace</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="toolbar">
                <button class="add-row" data-entity="services">Добавить сервис</button>
            </div>
            <table class="entity-table" data-entity="services"></table>
        </section>

        <!-- ===== ENDPOINT ===== -->
        <section class="tab" id="endpoint">
            <h2>Endpoint</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Endpoint</strong> — это точки опроса версий сервисов. Каждый эндпоинт привязан к сервису
                        и окружению, имеет URL и метод запроса (GET/POST).
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Добавить endpoint" для создания нового эндпоинта</li>
                            <li>Заполните поля: id (уникальный идентификатор), serviceId (ID сервиса), envId (ID
                                окружения), url (URL для опроса), method (HTTP метод)</li>
                            <li>Редактируйте данные прямо в таблице — просто кликните на ячейку</li>
                            <li>Используйте кнопку "Сформировать curl-команды" для генерации команд опроса всех
                                эндпоинтов</li>
                            <li>Импортируйте эндпоинты из Excel через вкладку Excel Workspace</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="toolbar">
                <button class="add-row" data-entity="endpoints">Добавить endpoint</button>
            </div>
            <table class="entity-table" data-entity="endpoints"></table>

            <h3>Автогенерация curl / HTTP-запросов</h3>
            <div class="toolbar">
                <button id="genCurl">Сформировать curl-команды</button>
            </div>
            <textarea id="curlOutput" readonly
                placeholder="Здесь появятся команды curl для всех endpoint'ов"></textarea>
        </section>

        <!-- ===== VERSION SNAPSHOT ===== -->
        <section class="tab" id="snapshot">
            <h2>Version Snapshot</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Version Snapshot</strong> — это снимки версий эндпоинтов на определённый момент времени.
                        Здесь хранится история версий: какая версия была на каком эндпоинте и когда.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Добавить снапшот вручную" для ручного добавления версии</li>
                            <li>Или используйте "Импорт результата опроса" — вставьте JSON с результатами опроса
                                эндпоинтов</li>
                            <li>Формат JSON: <code>{"endpointId": "svc1-prod", "version": "1.0.0", "build": "42"}</code>
                                или массив таких объектов</li>
                            <li>Редактируйте данные прямо в таблице — просто кликните на ячейку</li>
                            <li>Данные используются в Dashboard для анализа и в Version Matrix для сравнения</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="toolbar">
                <button class="add-row" data-entity="snapshots">Добавить снапшот вручную</button>
            </div>
            <table class="entity-table" data-entity="snapshots"></table>

            <h3>Импорт результата опроса (JSON)</h3>
            <p class="hint">
                Поддерживается один объект или массив объектов, вид:<br>
                { "endpointId": "svc1-prod", "version": "1.0.0", "build": "42" }
            </p>
            <textarea id="snapshotJson" placeholder="Вставьте JSON с результатами опроса"></textarea>
            <div class="toolbar">
                <button id="applySnapshotJson">Применить</button>
            </div>
        </section>

        <!-- ===== VERSION MATRIX ===== -->
        <section class="tab" id="matrix">
            <h2>Матрица версий (Service × Environment)</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Version Matrix</strong> — это таблица для сравнения версий сервисов по окружениям. Вы
                        можете выбрать эталонное окружение и увидеть, какие версии отличаются от эталона.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Выберите эталонное окружение из выпадающего списка</li>
                            <li>Заполните версии в ячейках таблицы — просто кликните на ячейку и введите версию</li>
                            <li>Ячейки, отличающиеся от эталонного окружения, будут подсвечены красным</li>
                            <li>Данные матрицы хранятся отдельно и не зависят от Version Snapshot</li>
                            <li>Используйте матрицу для планирования обновлений и выравнивания версий</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="toolbar">
                <label>Эталонное окружение:
                    <select id="matrixBaseline"></select>
                </label>
            </div>
            <div class="matrix-wrapper">
                <table id="versionMatrix"></table>
            </div>
            <p class="hint">
                Ячейки, отличающиеся от эталонного окружения, подсвечены. Данные матрицы хранятся отдельно в
                localStorage
                и не завязаны на снапшоты.
            </p>
        </section>

        <!-- ===== EXCEL WORKSPACE ===== -->
        <section class="tab" id="excel">
            <h2>Excel Workspace (универсальный)</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Excel Workspace</strong> — это универсальная рабочая зона для работы с Excel и CSV
                        файлами. Здесь вы можете загружать файлы, просматривать данные, искать информацию, генерировать
                        команды и скрипты, а также импортировать данные в инвентарь.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Загрузите Excel/CSV файл(ы) — можно выбрать несколько файлов одновременно</li>
                            <li>Выберите лист из выпадающего списка (если в файле несколько листов)</li>
                            <li>Используйте поиск для быстрого нахождения данных (локальный по текущему листу или
                                глобальный по всем файлам)</li>
                            <li>Отметьте нужные колонки чекбоксами для использования в билдере строк</li>
                            <li>Создайте шаблон команды с плейсхолдерами <code>{ColumnName}</code> и сформируйте команды
                                для всех строк</li>
                            <li>Импортируйте данные в инвентарь через маппинг колонок или используйте Zabbix Builder для
                                генерации скриптов</li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Основные функции:</strong> Загрузка файлов, поиск, фильтрация, генерация команд, импорт
                        в инвентарь, Zabbix Builder
                    </div>
                </div>
            </div>

            <!-- Загрузка -->
            <h3>Загрузка Excel</h3>
            <div class="toolbar">
                <input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" multiple>
                <label>Лист:
                    <select id="excelSheetSelect"></select>
                </label>
                <label>Или использовать Dataset:
                    <select id="excelDatasetSelect">
                        <option value="">Нет</option>
                    </select>
                </label>
            </div>
            <p class="hint">
                Можно загружать несколько Excel/CSV файлов одновременно. Структура не жёсткая.
            </p>
            <div id="excelFileList"></div>

            <!-- Поиск и фильтрация -->
            <h3>Поиск и фильтрация</h3>
            <div class="toolbar">
                <label>Быстрый поиск по текущему листу:
                    <input type="text" id="excelFilterInput" placeholder="поиск по всем колонкам">
                </label>
                <label>Глобальный поиск по всем файлам:
                    <input type="text" id="excelGlobalSearchInput" placeholder="поиск по всем файлам и листам">
                    <button id="excelGlobalSearchBtn" class="btn-small">Найти</button>
                </label>
            </div>
            <div id="excelGlobalSearchResults" class="search-results-compact"></div>

            <div class="excel-columns-panel">
                <div class="excel-columns-block">
                    <h3>Колонки листа</h3>
                    <p class="hint">Отмеченные колонки будут использоваться в билдере строк.</p>
                    <ul id="excelColumnsList"></ul>
                </div>

                <div class="excel-builder-block">
                    <h3>Билдер строк (шаблон)</h3>
                    <p class="hint">
                        Используйте плейсхолдеры вида <code>{ColumnName}</code>.<br>
                        Например: <code>ssh {host} -p {port}</code> или
                        <code>curl http://{ip}:{port}/version</code>.
                    </p>
                    <textarea id="excelTemplateInput"
                        placeholder="Шаблон одной строки, используйте {ColumnName} для подстановки значений из Excel"></textarea>
                    <div class="toolbar">
                        <button id="excelInsertSelectedColumnsBtn">Вставить выбранные колонки в шаблон</button>
                        <button id="excelApplyTemplateBtn">Сформировать строки по всем строкам</button>
                    </div>
                </div>
            </div>

            <!-- Импорт в инвентарь -->
            <h3>Импорт в инвентарь (из Excel)</h3>
            <div class="toolbar">
                <label>Целевая сущность:
                    <select id="excelImportEntity">
                        <option value="hosts">Host</option>
                        <option value="services">Service</option>
                        <option value="endpoints">Endpoint</option>
                        <option value="snapshots">Snapshot</option>
                        <option value="environments">Environment</option>
                    </select>
                </label>
            </div>
            <p class="hint">
                Маппинг: какие поля сущности брать из каких колонок Excel. Импортируются строки текущего листа с учётом
                фильтра.
                Поля пытаются автоматически сопоставляться по названию (host/ip/port/env/service и т.п.).
            </p>
            <div class="excel-import-mapping-wrapper">
                <table id="excelImportMappingTable"></table>
            </div>
            <div class="toolbar">
                <button id="excelImportApplyBtn">Импортировать в выбранную сущность</button>
            </div>

            <!-- Превью данных листа -->
            <h3>Превью данных листа</h3>
            <div class="excel-table-wrapper">
                <table id="excelDataTable"></table>
            </div>

            <!-- Результат строкобилдера -->
            <h3>Результат (скрипты / команды)</h3>
            <textarea id="excelOutputArea" readonly
                placeholder="Здесь будут сформированные строки по шаблону для всех строк Excel"></textarea>

            <!-- Zabbix Builder -->
            <h3>Zabbix Agent Builder</h3>
            <p class="hint">
                Использует текущий лист Excel. По выбранным колонкам строит:<br>
                1) заготовку скрипта для zabbix-агента,<br>
                2) строку UserParameter для zabbix_agentd.conf,<br>
                3) inventory-файл (host;port) по текущему листу и фильтру.
            </p>
            <div class="toolbar">
                <label>Колонка host:
                    <select id="zbxHostCol"></select>
                </label>
                <label>Колонка port (опц.):
                    <select id="zbxPortCol"></select>
                </label>
                <label>Имя ключа (item key):
                    <input type="text" id="zbxItemKey" value="iib.version">
                </label>
                <label>Путь скрипта:
                    <input type="text" id="zbxScriptPath" value="/usr/local/bin/iib_version.sh">
                </label>
            </div>
            <div class="toolbar">
                <button id="zbxBuildBtn">Сформировать Zabbix-скрипт и конфиг</button>
            </div>

            <h3>Скрипт для zabbix-агента</h3>
            <textarea id="zbxScriptArea" readonly></textarea>

            <h3>UserParameter для zabbix_agentd.conf</h3>
            <textarea id="zbxUserParamArea" readonly></textarea>

            <h3>Inventory host;port (по Excel)</h3>
            <textarea id="zbxInventoryArea" readonly></textarea>
        </section>

        <!-- ===== GLOBAL SEARCH ===== -->
        <!-- ===== SQL / BI ENGINE ===== -->
        <section class="tab" id="sql">
            <h2>SQL / BI Engine</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>SQL / BI Engine</strong> — это инструмент для выполнения SQL-подобных запросов к данным
                        из загруженных Excel/CSV файлов. Позволяет фильтровать, группировать, сортировать и объединять
                        данные без написания кода.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Выберите источник данных (лист) из выпадающего списка</li>
                            <li>Опционально выберите лист для JOIN (объединения данных)</li>
                            <li>Введите SQL-запрос в текстовое поле (например:
                                <code>SELECT host, ip WHERE env = "prod"</code>)
                            </li>
                            <li>Нажмите "Выполнить" для выполнения запроса</li>
                            <li>Просмотрите результаты в таблице</li>
                            <li>Используйте "Примеры" для просмотра примеров запросов</li>
                            <li>Экспортируйте результаты в CSV или JSON</li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Поддерживаемые операции:</strong> SELECT, WHERE, ORDER BY, GROUP BY, JOIN, агрегации
                        (COUNT, SUM, AVG, MIN, MAX)
                    </div>
                </div>
            </div>

            <div class="sql-controls">
                <div class="sql-query-panel">
                    <h3>SQL Запрос</h3>
                    <div class="sql-source-selector">
                        <label>Источник данных (лист):
                            <select id="sqlSourceSheet">
                                <option value="">Выберите лист...</option>
                            </select>
                        </label>
                        <label>JOIN с листом (опционально):
                            <select id="sqlJoinSheet">
                                <option value="">Нет</option>
                            </select>
                        </label>
                    </div>
                    <textarea id="sqlQueryInput" class="sql-query-input"
                        placeholder='SELECT host, ip, env WHERE env = "prod" ORDER BY host'></textarea>
                    <div class="sql-query-buttons">
                        <button id="sqlExecuteBtn" class="btn-primary">Выполнить</button>
                        <button id="sqlClearBtn" class="btn-secondary">Очистить</button>
                        <button id="sqlExamplesBtn" class="btn-secondary">Примеры</button>
                    </div>
                </div>

                <div class="sql-results-panel">
                    <h3>Результаты</h3>
                    <div id="sqlResultsInfo" class="sql-results-info"></div>
                    <div id="sqlResultsTable" class="sql-results-table-wrapper"></div>
                    <div class="sql-export-buttons">
                        <button id="sqlExportCsvBtn" class="btn-small">Экспорт CSV</button>
                        <button id="sqlExportJsonBtn" class="btn-small">Экспорт JSON</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== TEMPLATES ===== -->
        <section class="tab" id="templates">
            <h2>Templates & Script Builder</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Templates</strong> — это сохранённые шаблоны команд и скриптов, которые можно применять
                        к данным из Excel. Шаблоны используют плейсхолдеры <code>{ColumnName}</code> для подстановки
                        значений из таблиц.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Создать шаблон" для создания нового шаблона</li>
                            <li>Укажите название, тип (SSH, CURL, SQL, Ansible, Zabbix и др.), категорию и описание</li>
                            <li>Напишите шаблон с плейсхолдерами (например: <code>ssh {host} -p {port}</code>)</li>
                            <li>Используйте кнопку "Тест" для проверки шаблона на примере</li>
                            <li>Сохраните шаблон — он будет доступен для использования в Excel Workspace</li>
                            <li>Фильтруйте шаблоны по типу для быстрого поиска</li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Типы шаблонов:</strong> SSH, CURL, SQL, Ansible, Zabbix, Bash, PowerShell, Generic
                    </div>
                </div>
            </div>

            <div class="templates-panel">
                <div class="templates-list-panel">
                    <h3>Сохраненные шаблоны</h3>
                    <div class="toolbar">
                        <button id="templateNewBtn" class="btn-primary">Создать шаблон</button>
                        <select id="templateFilterType">
                            <option value="">Все типы</option>
                            <option value="ssh">SSH</option>
                            <option value="curl">CURL</option>
                            <option value="sql">SQL</option>
                            <option value="ansible">Ansible</option>
                            <option value="zabbix">Zabbix</option>
                            <option value="bash">Bash</option>
                            <option value="powershell">PowerShell</option>
                            <option value="generic">Generic</option>
                        </select>
                    </div>
                    <div id="templatesList" class="templates-list"></div>
                </div>

                <div class="template-editor-panel">
                    <h3>Редактор шаблона</h3>
                    <div class="template-form">
                        <label>Название:
                            <input type="text" id="templateNameInput" placeholder="Название шаблона">
                        </label>
                        <label>Тип:
                            <select id="templateTypeSelect">
                                <option value="generic">Generic</option>
                                <option value="ssh">SSH</option>
                                <option value="curl">CURL</option>
                                <option value="sql">SQL</option>
                                <option value="ansible">Ansible</option>
                                <option value="zabbix">Zabbix</option>
                                <option value="bash">Bash</option>
                                <option value="powershell">PowerShell</option>
                            </select>
                        </label>
                        <label>Категория:
                            <select id="templateCategorySelect">
                                <option value="commands">Commands</option>
                                <option value="scripts">Scripts</option>
                                <option value="configs">Configs</option>
                            </select>
                        </label>
                        <label>Описание:
                            <input type="text" id="templateDescriptionInput" placeholder="Описание шаблона">
                        </label>
                        <label>Шаблон:
                            <textarea id="templateContentInput" class="template-content-input"
                                placeholder='Используйте {ColumnName} для подстановки значений'></textarea>
                        </label>
                        <div class="toolbar">
                            <button id="templateSaveBtn" class="btn-primary">Сохранить</button>
                            <button id="templateDeleteBtn" class="btn-danger">Удалить</button>
                            <button id="templateTestBtn" class="btn-secondary">Тест</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== DATASETS ===== -->
        <section class="tab" id="datasets">
            <h2>Datasets (Конструктор данных)</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Datasets</strong> — это конструктор для создания логических наборов данных из разных
                        источников. Вы можете собрать собственный инвентарь, выбрав нужные колонки из загруженных
                        Excel/CSV файлов, применив фильтры и дав колонкам понятные имена.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Нажмите "Создать Dataset" для создания нового набора данных</li>
                            <li>Выберите источник: файл и лист из уже загруженных Excel/CSV</li>
                            <li>Выберите нужные колонки и задайте им понятные имена (опционально)</li>
                            <li>Добавьте простые фильтры (по env/host/port и т.п.)</li>
                            <li>Сохраните Dataset — он будет доступен для просмотра, экспорта и использования в других
                                модулях</li>
                            <li>Используйте Dataset для генерации команд (как в Excel Workspace) или импорта в Inventory
                            </li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Источники данных:</strong> Загруженные Excel/CSV файлы и их листы.
                        <strong>Интеграция:</strong> Excel Workspace (генерация команд), Inventory (импорт данных)
                    </div>
                </div>
            </div>

            <div class="datasets-panel">
                <div class="datasets-list-panel">
                    <h3>Сохраненные Datasets</h3>
                    <div class="toolbar">
                        <button id="datasetNewBtn" class="btn-primary">Создать Dataset</button>
                    </div>
                    <div id="datasetsList" class="datasets-list">
                        <!-- Список Datasets будет добавлен динамически -->
                    </div>
                </div>

                <div class="dataset-editor-panel">
                    <h3>Редактор Dataset</h3>
                    <div class="dataset-form">
                        <label>Название:
                            <input type="text" id="datasetNameInput" placeholder="Название Dataset">
                        </label>
                        <label>Описание:
                            <input type="text" id="datasetDescriptionInput"
                                placeholder="Описание Dataset (опционально)">
                        </label>
                        <label>Источник данных (файл):
                            <select id="datasetSourceFile">
                                <option value="">Выберите файл...</option>
                            </select>
                        </label>
                        <label>Лист:
                            <select id="datasetSourceSheet">
                                <option value="">Выберите лист...</option>
                            </select>
                        </label>
                        <div class="toolbar">
                            <button id="datasetSaveBtn" class="btn-primary">Сохранить</button>
                            <button id="datasetDeleteBtn" class="btn-danger">Удалить</button>
                            <button id="datasetPreviewBtn" class="btn-secondary">Предпросмотр</button>
                        </div>
                    </div>

                    <h4>Выбор колонок</h4>
                    <div id="datasetColumnsList" class="dataset-columns-list">
                        <!-- Колонки будут добавлены динамически -->
                    </div>

                    <h4>Фильтры</h4>
                    <div id="datasetFiltersList" class="dataset-filters-list">
                        <p class="hint">Фильтры будут добавлены в следующей итерации</p>
                    </div>
                </div>
            </div>

            <div class="dataset-preview-panel">
                <h3>Предпросмотр данных</h3>
                <div id="datasetPreviewTable" class="dataset-preview-table-wrapper">
                    <p class="hint">Выберите Dataset для предпросмотра</p>
                </div>
                <div class="toolbar">
                    <button id="datasetExportCsvBtn" class="btn-small">Экспорт CSV</button>
                    <button id="datasetExportJsonBtn" class="btn-small">Экспорт JSON</button>
                </div>
            </div>
        </section>

        <!-- ===== SCAN / JOBS ===== -->
        <section class="tab" id="scan">
            <h2>Scan / Jobs</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Scan / Jobs</strong> — это модуль для управления задачами опроса эндпоинтов и хостов.
                        Здесь вы можете создавать задачи опроса, запускать их вручную, просматривать результаты и
                        автоматически создавать снапшоты версий из успешных опросов.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li>Создайте Job — задачу опроса, выбрав тип (endpoints или hosts) и целевые объекты</li>
                            <li>Выберите шаблон команды (опционально) для генерации команд опроса</li>
                            <li>Запустите Job вручную — получите список команд для выполнения</li>
                            <li>Выполните команды вручную (или через скрипт) и вставьте результаты</li>
                            <li>Просмотрите результаты опросов — статусы, извлеченные версии, ошибки</li>
                            <li>Успешные опросы автоматически создают Version Snapshots</li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Источники данных:</strong> Endpoint, Host (для выбора целей), Template (для шаблонов
                        команд), VersionSnapshot (автоматическое создание)
                    </div>
                </div>
            </div>

            <!-- Список Jobs -->
            <div class="scan-jobs-panel">
                <div class="scan-jobs-list-panel">
                    <h3>Задачи опроса (Jobs)</h3>
                    <div class="toolbar">
                        <button id="scanNewJobBtn" class="btn-primary">Создать Job</button>
                    </div>
                    <div id="scanJobsList" class="scan-jobs-list">
                        <!-- Список Jobs будет добавлен динамически -->
                    </div>
                </div>

                <div class="scan-job-editor-panel">
                    <h3>Редактор Job</h3>
                    <div class="scan-job-form">
                        <label>Название:
                            <input type="text" id="scanJobNameInput" placeholder="Название задачи">
                        </label>
                        <label>Описание:
                            <textarea id="scanJobDescriptionInput" placeholder="Описание задачи (опционально)"
                                rows="2"></textarea>
                        </label>
                        <label>Тип опроса:
                            <select id="scanJobTypeSelect">
                                <option value="endpoints">Endpoints</option>
                                <option value="hosts">Hosts</option>
                            </select>
                        </label>
                        <label>Шаблон команды (опционально):
                            <select id="scanJobTemplateSelect">
                                <option value="">Нет (стандартный формат)</option>
                            </select>
                        </label>
                        <label>Статус:
                            <select id="scanJobStatusSelect">
                                <option value="active">Active</option>
                                <option value="paused">Paused</option>
                            </select>
                        </label>
                        <div class="toolbar">
                            <button id="scanJobSaveBtn" class="btn-primary">Сохранить</button>
                            <button id="scanJobDeleteBtn" class="btn-danger">Удалить</button>
                            <button id="scanJobRunBtn" class="btn-secondary">Запустить</button>
                        </div>
                    </div>

                    <h4>Выбор целей</h4>
                    <div id="scanJobTargetsPanel" class="scan-job-targets-panel">
                        <!-- Выбор целей будет добавлен динамически -->
                    </div>
                </div>
            </div>

            <!-- Результаты опросов -->
            <div class="scan-results-panel">
                <h3>Результаты опросов</h3>
                <div class="toolbar">
                    <label>Фильтр по Job:
                        <select id="scanResultsJobFilter">
                            <option value="">Все Jobs</option>
                        </select>
                    </label>
                    <label>Фильтр по статусу:
                        <select id="scanResultsStatusFilter">
                            <option value="">Все статусы</option>
                            <option value="success">Success</option>
                            <option value="error">Error</option>
                            <option value="timeout">Timeout</option>
                        </select>
                    </label>
                    <label>Поиск:
                        <input type="text" id="scanResultsSearchInput" placeholder="Поиск по endpoint/host...">
                    </label>
                    <button id="scanResultsRefreshBtn" class="btn-small">Обновить</button>
                </div>
                <div id="scanResultsTable" class="scan-results-table-wrapper">
                    <!-- Таблица результатов будет добавлена динамически -->
                </div>
            </div>

            <!-- Импорт результатов (ручная вставка) -->
            <div class="scan-import-panel">
                <h3>Импорт результатов опроса</h3>
                <p class="hint">
                    Вставьте результаты опроса в формате JSON. Каждый результат должен содержать:
                    <code>jobId</code>, <code>endpointId</code> или <code>hostId</code>, <code>status</code>,
                    <code>response</code> (опционально), <code>error</code> (если есть).
                </p>
                <textarea id="scanImportResultsTextarea" rows="10"
                    placeholder='[{"jobId": "job_123", "endpointId": "ep_1", "status": "success", "response": "{\"version\": \"1.0.0\"}"}]'></textarea>
                <div class="toolbar">
                    <button id="scanImportResultsBtn" class="btn-primary">Импортировать результаты</button>
                </div>
            </div>
        </section>

        <!-- ===== IMPORT / EXPORT ===== -->
        <section class="tab" id="importExport">
            <h2>Экспорт / Импорт</h2>

            <div class="info-block">
                <div class="info-block-title">Что это?</div>
                <div class="info-block-content">
                    <div class="info-block-section">
                        <strong>Import / Export</strong> — это инструмент для экспорта данных из инвентаря в JSON/CSV и
                        импорта данных обратно. Позволяет создавать резервные копии и переносить данные между
                        экземплярами приложения.
                    </div>
                    <div class="info-block-section">
                        <strong>Как использовать:</strong>
                        <ul class="info-block-list">
                            <li><strong>Экспорт JSON:</strong> Выберите сущность (Environment, Host, Service и т.д.) и
                                нажмите "Экспорт JSON" — данные появятся в текстовом поле</li>
                            <li><strong>Экспорт CSV:</strong> Выберите сущность и нажмите "Экспорт CSV" — данные
                                появятся в текстовом поле</li>
                            <li><strong>Импорт JSON:</strong> Вставьте полный JSON дамп базы в текстовое поле и нажмите
                                "Импорт с полной заменой" — все данные будут заменены</li>
                            <li>Скопируйте экспортированные данные для сохранения или переноса</li>
                        </ul>
                    </div>
                    <div class="info-block-sources">
                        <strong>Формат импорта:</strong>
                        <code>{"environments": [...], "hosts": [...], "services": [...], "endpoints": [...], "snapshots": [...]}</code>
                    </div>
                </div>
            </div>

            <h3>Экспорт JSON</h3>
            <div class="toolbar">
                <label>Сущность:
                    <select id="exportJsonSelect"></select>
                </label>
                <button id="exportJsonBtn">Экспорт JSON</button>
            </div>
            <textarea id="exportJsonArea" readonly placeholder="Здесь будет JSON выбранной сущности"></textarea>

            <h3>Экспорт CSV</h3>
            <div class="toolbar">
                <label>Сущность:
                    <select id="exportCsvSelect"></select>
                </label>
                <button id="exportCsvBtn">Экспорт CSV</button>
            </div>
            <textarea id="exportCsvArea" readonly placeholder="Здесь будет CSV выбранной сущности"></textarea>

            <h3>Импорт JSON (полная замена всей базы)</h3>
            <p class="hint">
                Ожидается объект вида:<br>
                { "environments": [...], "hosts": [...], "services": [...], "endpoints": [...], "snapshots": [...] }
            </p>
            <textarea id="importJsonArea" placeholder="Вставьте полный JSON дамп базы"></textarea>
            <div class="toolbar">
                <button id="importJsonBtn">Импорт с полной заменой</button>
            </div>
        </section>
    </div>

    <!-- Excel парсер (чистый JS, без сервера) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>